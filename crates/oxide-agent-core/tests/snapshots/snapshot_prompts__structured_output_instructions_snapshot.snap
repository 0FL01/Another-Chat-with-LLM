---
source: crates/oxide-agent-core/tests/snapshot_prompts.rs
expression: build_structured_output_instructions(&tools)
---
## STRUCTURED OUTPUT (MANDATORY)
You MUST respond ONLY with a valid JSON object strictly following the schema:
{
  "thought": "Brief description of the solution and step",
  "tool_call": {
    "name": "tool_name",
    "arguments": {}
  },
  "final_answer": "Final answer to the user"
}

Rules:
- EXACTLY one of `tool_call` or `final_answer` must be filled (the other = null)
- If a tool is needed: `tool_call` = object, `final_answer` = null
- If answer is ready: `tool_call` = null, `final_answer` = string
- `tool_call.arguments` is always a JSON object
- No extra keys, markdown, XML, explanations, or text outside JSON
- Tool results arrive in messages with role `tool`
- In `final_answer`, ALWAYS use markdown code blocks (```language) for code, logs, terminal outputs, and file contents
- Use backticks (`) for inline code, such as file paths, variables, and short commands

### Example Tool Call
{"thought":"Need to read a file","tool_call":{"name":"read_file","arguments":{"filePath":"/abs/path/to/file.txt"}},"final_answer":null}

### Example Final Answer
{"thought":"File read, answer ready","tool_call":null,"final_answer":"Here is the content of `file.txt`:\n\n```rust\nfn main() {\n    println!(\"Hello world\");\n}\n```"}

## Available Tools (JSON schema)
[
  {
    "name": "test_tool",
    "description": "A test tool",
    "parameters": {
      "properties": {
        "arg1": {
          "type": "string"
        }
      },
      "type": "object"
    }
  }
]
