
TL;DR: Skill System –¥–ª—è Telegram AI-–∞–≥–µ–Ω—Ç–∞
–ß—Ç–æ –¥–µ–ª–∞–µ–º
–í–Ω–µ–¥—Ä—è–µ–º –º–æ–¥—É–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é Claude Skills: —Ä–∞–∑–±–∏–≤–∞–µ–º –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π AGENT.md (~2000 —Ç–æ–∫–µ–Ω–æ–≤) –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (web-search.md, video-processing.md, –∏ —Ç.–¥.) —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Mistral Codestral Embed (256-dim –≤–µ–∫—Ç–æ—Ä—ã).

Hybrid Skill System —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π
üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∏–¥–µ–π –≤ –ø—Ä–æ–µ–∫—Ç–µ
–û—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã:
1. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ‚Üí src/agent/provider.rs + src/agent/registry.rs
   - –ü–∞—Ç—Ç–µ—Ä–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
   - Trait-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–∏–Ω–≥ –≤—ã–∑–æ–≤–æ–≤
2. –°–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏ —Å —Ç–æ–∫–µ–Ω-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–æ–º ‚Üí src/agent/memory.rs
   - –ü–æ–¥—Å—á—ë—Ç —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ tiktoken
   - –ê–≤—Ç–æ-–∫–æ–º–ø–∞–∫—Ç–∞—Ü–∏—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
   - –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
3. Hooks —Å–∏—Å—Ç–µ–º–∞ ‚Üí src/agent/hooks/
   - –ü–∞—Ç—Ç–µ—Ä–Ω —Å–æ–±—ã—Ç–∏–π–Ω—ã—Ö –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫–æ–≤
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è
   - –ò–∑–æ–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
4. Loop Detection Service ‚Üí src/agent/loop_detection/
   - –ú–Ω–æ–≥–æ—Ñ–∞–π–ª–æ–≤–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ environment variables
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å executor —á–µ—Ä–µ–∑ Arc<Mutex<>>
5. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ frontmatter ‚Üí –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –∏–∑ backlog/docs/skills/skills.md
   - YAML frontmatter –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
   - Progressive disclosure –ø–∞—Ç—Ç–µ—Ä–Ω
   - Model-invoked –∞–∫—Ç–∏–≤–∞—Ü–∏—è
üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ñ–∞–π–ª–æ–≤
–ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏:
src/agent/skills/
‚îú‚îÄ‚îÄ mod.rs              # –ü—É–±–ª–∏—á–Ω—ã–π API, re-exports
‚îú‚îÄ‚îÄ types.rs            # Skill, SkillMetadata, SkillWeight, ActivationMode
‚îú‚îÄ‚îÄ loader.rs           # –ü–∞—Ä—Å–∏–Ω–≥ .md —Ñ–∞–π–ª–æ–≤ —Å YAML frontmatter
‚îú‚îÄ‚îÄ registry.rs         # SkillRegistry —Å embedding-based –ø–æ–∏—Å–∫–æ–º
‚îú‚îÄ‚îÄ embeddings.rs       # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Mistral codestral-embed
‚îú‚îÄ‚îÄ matcher.rs          # –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –∏ –∫–ª—é—á–µ–≤–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ cache.rs            # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ embeddings –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∫–∏–ª–ª–æ–≤
skills/                 # –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞, —Ä—è–¥–æ–º —Å AGENT.md
‚îú‚îÄ‚îÄ core.md            # –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (–±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îú‚îÄ‚îÄ web-search.md      # web_search, web_extract
‚îú‚îÄ‚îÄ video-processing.md # ytdlp_* –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ file-management.md # execute_command, write_file, read_file, send_file_to_user
‚îú‚îÄ‚îÄ file-hosting.md    # upload_file
‚îî‚îÄ‚îÄ task-planning.md   # write_todos
.embeddings_cache/     # –ö—ç—à –≤–µ–∫—Ç–æ—Ä–æ–≤ (gitignore)
‚îî‚îÄ‚îÄ skills/
    ‚îú‚îÄ‚îÄ web-search.bin
    ‚îú‚îÄ‚îÄ video-processing.bin
    ‚îî‚îÄ‚îÄ ...
–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤:
src/agent/
‚îú‚îÄ‚îÄ mod.rs              # –î–æ–±–∞–≤–∏—Ç—å pub mod skills;
‚îú‚îÄ‚îÄ session.rs          # –î–æ–±–∞–≤–∏—Ç—å skill_cache: SkillCache
‚îú‚îÄ‚îÄ executor.rs         # –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å create_agent_system_prompt()
‚îî‚îÄ‚îÄ memory.rs           # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∫–∏–ª–ª–æ–≤
src/llm/
‚îú‚îÄ‚îÄ mod.rs              # –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ generate_embedding()
‚îî‚îÄ‚îÄ providers.rs        # –î–æ–±–∞–≤–∏—Ç—å Mistral embedding endpoint
src/config.rs           # –î–æ–±–∞–≤–∏—Ç—å SKILL_* –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
Cargo.toml              # –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –Ω–æ–≤—ã–µ)
üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
1. SkillMetadata (types.rs)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–∏–ª–ª–∞ –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
–ü–æ–ª—è:
- name: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–∫–∏–ª–ª–∞
- description: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è embedding-–ø–æ–∏—Å–∫–∞
- triggers: –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –º–∞—Ç—á–∏–Ω–≥–∞ (fallback)
- allowed_tools: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–∫–∞–∫ –≤ OpenCode)
- weight: SkillWeight (Always/High/Medium/OnDemand)
- references: –ü—É—Ç–∏ –∫ supporting —Ñ–∞–π–ª–∞–º (progressive disclosure)
- embedding: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä (256-dim f32)
–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–¥–µ–∏: Frontmatter –∏–∑ backlog/docs/skills/skills.md + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ src/agent/loop_detection/types.rs
---
2. Skill (types.rs)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∫–∏–ª–ª–∞ —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
–ü–æ–ª—è:
- metadata: SkillMetadata
- content: Markdown –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å–ª–µ frontmatter
- supporting_files: HashMap<PathBuf, LazyContent> –¥–ª—è progressive disclosure
- loaded_at: Timestamp –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º
- token_count: –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ —Ç–æ–∫–µ–Ω–∞—Ö
–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–¥–µ–∏: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ AgentMessage –≤ src/agent/memory.rs
---
3. SkillRegistry (registry.rs)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Å–∫–∏–ª–ª–æ–≤
–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
- load_all_metadata(): –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞ - –ø–∞—Ä—Å–∏—Ç –≤—Å–µ .md —Ñ–∞–π–ª—ã –≤ skills/, –∏–∑–≤–ª–µ–∫–∞–µ—Ç frontmatter
- get_embeddings(): –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–µ–∫—Ç–æ—Ä—ã –¥–ª—è descriptions —á–µ—Ä–µ–∑ Mistral API
- select_skills_semantic(): –ü—Ä–∏–Ω–∏–º–∞–µ—Ç user_message, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ø-N —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å–∫–∏–ª–ª–æ–≤
- select_skills_by_tool(): –ù–∞—Ö–æ–¥–∏—Ç —Å–∫–∏–ª–ª –ø–æ –∏–º–µ–Ω–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (–∏–∑ allowed_tools)
- load_skill_content(): –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–∫–∏–ª–ª–∞
- invalidate_cache(): –°–±—Ä–æ—Å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤ (–¥–ª—è dev —Ä–µ–∂–∏–º–∞)
–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–¥–µ–∏: –ü–∞—Ç—Ç–µ—Ä–Ω –∏–∑ src/agent/registry.rs (ToolRegistry)
---
4. EmbeddingService (embeddings.rs)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Mistral Codestral Embed
–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
- generate_embedding(): –í—ã–∑–æ–≤ Mistral API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–∞
- batch_generate(): –ü–∞–∫–µ—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Å–∫–∏–ª–ª–æ–≤
- cosine_similarity(): –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ö–æ–∂–µ—Å—Ç–∏ –≤–µ–∫—Ç–æ—Ä–æ–≤
- load_from_cache() / save_to_cache(): –†–∞–±–æ—Ç–∞ —Å .embeddings_cache/
–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–¥–µ–∏: HTTP –∫–ª–∏–µ–Ω—Ç –∏–∑ src/llm/http_utils.rs + –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏–∑ src/llm/providers.rs
Endpoint: https://api.mistral.ai/v1/embeddings (model: mistral-embed)
---
5. SkillMatcher (matcher.rs)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ì–∏–±—Ä–∏–¥–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (—Å–µ–º–∞–Ω—Ç–∏–∫–∞ + —Ç—Ä–∏–≥–≥–µ—Ä—ã)
–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –ë—ã—Å—Ç—Ä—ã–π –ø—É—Ç—å: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã (–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞) - O(1)
2. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å: –ï—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏ - embedding similarity
3. Tool-based –ø—É—Ç—å: –ï—Å–ª–∏ –≤—ã–∑–≤–∞–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç - –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å–∫–∏–ª–ª
–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–¥–µ–∏: –õ–æ–≥–∏–∫–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ –∏–∑ src/agent/loop_detection/matcher.rs (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) + src/agent/loop_detection/service.rs
---
6. SkillCache (cache.rs)
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Å—Å–∏–∏ –∏ –¥–∏—Å–∫–∞
–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
- session_cache: HashMap<SkillName, LoadedSkill> - —Å–∫–∏–ª–ª—ã –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
- embedding_cache: HashMap<SkillName, Vec<f32>> - –∫—ç—à –≤–µ–∫—Ç–æ—Ä–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ
- max_loaded_skills: –õ–∏–º–∏—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∫–∏–ª–ª–æ–≤
–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–¥–µ–∏: –ü–∞—Ç—Ç–µ—Ä–Ω –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ src/storage.rs + —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –∏–∑ src/agent/memory.rs
---
üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
–§–∞–∑–∞ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ (startup)
main.rs
  ‚Üì
AgentExecutor::new()
  ‚Üì
SkillRegistry::new()
  ‚Üì
SkillLoader::load_all_metadata("skills/")
  ‚Üì (–ø–∞—Ä—Å–∏–Ω–≥ frontmatter)
SkillMetadata[] (—Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, ~50-100 —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ —Å–∫–∏–ª–ª)
  ‚Üì
EmbeddingService::batch_generate()
  ‚Üì (–µ—Å–ª–∏ –Ω–µ—Ç –≤ .embeddings_cache/)
Mistral API ‚Üí Vec<f32>[256] –¥–ª—è –∫–∞–∂–¥–æ–≥–æ description
  ‚Üì
–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ .embeddings_cache/
–í—Ä–µ–º—è: ~1-2 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ —Ö–æ–ª–æ–¥–Ω–æ–º —Å—Ç–∞—Ä—Ç–µ, ~50ms –ø—Ä–∏ –ø—Ä–æ–≥—Ä–µ—Ç–æ–º –∫—ç—à–µ
---
–§–∞–∑–∞ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
User Message: "–ù–∞–π–¥–∏ –≤–∏–¥–µ–æ –ø—Ä–æ Rust –∏ —Å–∫–∞—á–∞–π –µ–≥–æ"
  ‚Üì
AgentExecutor::execute_task()
  ‚Üì
create_agent_system_prompt(user_message)
  ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å core.md (Always)      ‚îÇ
‚îÇ    ‚Üí ~500 —Ç–æ–∫–µ–Ω–æ–≤                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. SkillMatcher::select_skills()   ‚îÇ
‚îÇ    Input: "–ù–∞–π–¥–∏ –≤–∏–¥–µ–æ –ø—Ä–æ Rust..." ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚Üì
2a. –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤:
    - web-search.md: ["–Ω–∞–π–¥–∏", "–ø–æ–∏—â–∏"] ‚úì
    - video-processing.md: ["–≤–∏–¥–µ–æ", "—Å–∫–∞—á–∞–π"] ‚úì
  ‚Üì
2b. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
    - EmbeddingService::generate_embedding(user_message)
    - cosine_similarity —Å –∫–∞–∂–¥—ã–º —Å–∫–∏–ª–ª–æ–º
    - –¢–æ–ø-3 –ø–æ score: 
      1. video-processing (0.87)
      2. web-search (0.72)
      3. file-management (0.45)
  ‚Üì
2c. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
    - video-processing: weight=High, trigger_match=true, semantic_score=0.87 ‚Üí LOAD
    - web-search: weight=Medium, trigger_match=true, semantic_score=0.72 ‚Üí LOAD
    - file-management: weight=Medium, semantic_score=0.45 ‚Üí SKIP
  ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. SkillRegistry::load_skills()    ‚îÇ
‚îÇ    ["video-processing", "web-search"]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚Üì
–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:
  - video-processing.md ‚Üí ~800 —Ç–æ–∫–µ–Ω–æ–≤
  - web-search.md ‚Üí ~300 —Ç–æ–∫–µ–Ω–æ–≤
  ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ System Prompt      ‚îÇ
‚îÇ    core.md (500)                    ‚îÇ
‚îÇ    + video-processing.md (800)      ‚îÇ
‚îÇ    + web-search.md (300)            ‚îÇ
‚îÇ    = 1600 —Ç–æ–∫–µ–Ω–æ–≤                   ‚îÇ
‚îÇ    vs —Å—Ç–∞—Ä—ã–π AGENT.md (2000 —Ç–æ–∫–µ–Ω–æ–≤)‚îÇ
‚îÇ    –≠–∫–æ–Ω–æ–º–∏—è: 20%                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
---
–§–∞–∑–∞ 3: Dynamic Loading (–≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
LLM Response: tool_call ‚Üí ytdlp_download_video
  ‚Üì
AgentExecutor::execute_tools()
  ‚Üì
SkillRegistry::get_skill_by_tool("ytdlp_download_video")
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞: video-processing.md —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω? ‚Üí –î–ê
  ‚Üì
SKIP (–Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç)
---
LLM Response: tool_call ‚Üí upload_file
  ‚Üì
SkillRegistry::get_skill_by_tool("upload_file")
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞: file-hosting.md –∑–∞–≥—Ä—É–∂–µ–Ω? ‚Üí –ù–ï–¢
  ‚Üì
load_skill_content("file-hosting")
  ‚Üì
AgentMemory::add_message(system_message):
  "[–ó–∞–≥—Ä—É–∂–µ–Ω –º–æ–¥—É–ª—å: file-hosting]
   ## –•–æ—Å—Ç–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤
   - upload_file: –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –≤ GoFile..."
  ‚Üì
–°–ª–µ–¥—É—é—â–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è LLM –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
---
üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è AgentExecutor (executor.rs)
–¢–µ–∫—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è create_agent_system_prompt() (—Å—Ç—Ä–æ–∫–∞ 1143):
- –ß–∏—Ç–∞–µ—Ç AGENT.md —Ü–µ–ª–∏–∫–æ–º
- ~2000 —Ç–æ–∫–µ–Ω–æ–≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ
–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ skills/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
2. –ï—Å–ª–∏ –µ—Å—Ç—å ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Skill System
3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π AGENT.md
–¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ skill_registry: Arc<SkillRegistry> –≤ AgentExecutor
- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å execute_tools() –¥–ª—è dynamic loading
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ refresh_skills_if_needed() –¥–ª—è hot-reload –≤ dev —Ä–µ–∂–∏–º–µ
---
–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è AgentSession (session.rs)
–î–æ–±–∞–≤–∏—Ç—å:
- loaded_skills: HashSet<String> - —Ç—Ä–µ–∫–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–∏–ª–ª–æ–≤ –≤ —Å–µ—Å—Å–∏–∏
- skill_token_count: usize - —Å–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞–Ω–∏–º–∞—é—Ç —Å–∫–∏–ª–ª—ã
–ú–µ—Ç–æ–¥—ã:
- reset() ‚Üí –æ—á–∏—Å—Ç–∏—Ç—å loaded_skills
- get_active_skills() ‚Üí —Å–ø–∏—Å–æ–∫ –¥–ª—è debug UI
---
–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è AgentMemory (memory.rs)
–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–¥–ª—è —Å—Ç—Ä–æ–≥–æ–≥–æ —Ç—Ä–µ–∫–∏–Ω–≥–∞):
- –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è MessageRole::SkillContext
- –ü—Ä–∏ –∫–æ–º–ø–∞–∫—Ç–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏ - —Å–æ—Ö—Ä–∞–Ω—è—Ç—å skill context messages
–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π MessageRole::System —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º [Skill: name]
---
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Mistral Embedding Provider (llm/providers.rs)
–ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –≤ LlmClient:
pub async fn generate_embedding(
    &self,
    text: &str,
    model: &str  // "mistral-embed"
) -> Result<Vec<f32>>
Endpoint: POST https://api.mistral.ai/v1/embeddings
Request:
{
  model: mistral-embed,
  input: [text to embed],
  encoding_format: float
}
Response: 256-—Ä–∞–∑–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä
–ò—Å—Ç–æ—á–Ω–∏–∫ –∏–¥–µ–∏: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã chat_completion() –≤ src/llm/providers.rs (—Å—Ç—Ä–æ–∫–∏ 33-41, 222-230)
---
üöÄ –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—É—Ç—å
–≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–î–µ–Ω—å 1-2)
–°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª–∏:
- src/agent/skills/types.rs - –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- src/agent/skills/loader.rs - –ø–∞—Ä—Å–∏–Ω–≥ YAML frontmatter
- src/agent/skills/mod.rs - –ø—É–±–ª–∏—á–Ω—ã–π API
–ò–¥–µ–∏:
- YAML –ø–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ serde_yaml (—É–∂–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö?)
- Markdown –ø–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ pulldown-cmark –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π split –ø–æ ---
- –ü–∞—Ç—Ç–µ—Ä–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä –∏–∑ src/agent/memory.rs
–¢–µ—Å—Ç: –ü–∞—Ä—Å–∏–Ω–≥ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ skills/test.md
---
–≠—Ç–∞–ø 2: Embedding Integration (–î–µ–Ω—å 2-3)
–°–æ–∑–¥–∞—Ç—å:
- src/agent/skills/embeddings.rs - Mistral API –∫–ª–∏–µ–Ω—Ç
- src/agent/skills/cache.rs - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤
–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥ (src/config.rs):
pub const MISTRAL_EMBED_MODEL: &str = "mistral-embed";
pub const EMBEDDING_CACHE_DIR: &str = ".embeddings_cache/skills";
pub const EMBEDDING_DIMENSION: usize = 256;
–ò–¥–µ–∏:
- HTTP –∫–ª–∏–µ–Ω—Ç –∏–∑ src/llm/http_utils.rs
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ bincode –∏–ª–∏ serde_json
- Cosine similarity: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ dot(a,b) / (norm(a) * norm(b))
–¢–µ—Å—Ç: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ embedding –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–∫–∏–ª–ª–∞
---
–≠—Ç–∞–ø 3: Registry & Matching (–î–µ–Ω—å 3-4)
–°–æ–∑–¥–∞—Ç—å:
- src/agent/skills/registry.rs - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
- src/agent/skills/matcher.rs - –≥–∏–±—Ä–∏–¥–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
–ò–¥–µ–∏:
- –ü–∞—Ç—Ç–µ—Ä–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–∑ src/agent/registry.rs
- –ê–ª–≥–æ—Ä–∏—Ç–º –º–∞—Ç—á–∏–Ω–≥–∞:
  1. Keyword match: –ø—Ä–æ—Å—Ç–æ–π contains() –ø–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º
  2. Semantic match: embedding similarity threshold (–Ω–∞–ø—Ä–∏–º–µ—Ä, >0.6)
  3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ: weighted score = 0.3 * keyword_match + 0.7 * semantic_score
–¢–µ—Å—Ç: –í—ã–±–æ—Ä —Å–∫–∏–ª–ª–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö user messages
---
–≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Executor (–î–µ–Ω—å 4-5)
–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å:
- src/agent/executor.rs::create_agent_system_prompt() - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SkillRegistry
- src/agent/executor.rs::execute_tools() - dynamic loading
–õ–æ–≥–∏–∫–∞:
1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ AgentExecutor ‚Üí –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å SkillRegistry
2. –í create_agent_system_prompt(user_message):
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å skills/core.md (always)
   - –í—ã–∑–≤–∞—Ç—å registry.select_skills(user_message, token_budget=1500)
   - –°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–∫–∏–ª–ª–æ–≤
   - –í–µ—Ä–Ω—É—Ç—å –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
–¢–µ—Å—Ç: E2E —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º LLM –∑–∞–ø—Ä–æ—Å–æ–º
---
–≠—Ç–∞–ø 5: Migration & Cleanup (–î–µ–Ω—å 5)
–†–∞–∑–±–∏—Ç—å AGENT.md:
1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π AGENT.md –≤ AGENT.md.backup
2. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É skills/:
   - core.md - —Å—Ç—Ä–æ–∫–∏ 1-10, 91-150 (–æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞)
   - web-search.md - —Å—Ç—Ä–æ–∫–∏ 31-33
   - video-processing.md - —Å—Ç—Ä–æ–∫–∏ 35-66
   - file-management.md - —Å—Ç—Ä–æ–∫–∏ 14-24
   - file-hosting.md - —Å—Ç—Ä–æ–∫–∏ 25-29
   - task-planning.md - —Å—Ç—Ä–æ–∫–∏ 5-90
3. –î–æ–±–∞–≤–∏—Ç—å frontmatter –≤ –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª:
      ---
   name: web-search
   description: –ü–æ–∏—Å–∫ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ–≤–æ—Å—Ç–µ–π, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
   triggers: [–Ω–∞–π–¥–∏, –ø–æ–∏—â–∏, –ø–æ–∏—Å–∫, –∞–∫—Ç—É–∞–ª—å–Ω, –Ω–æ–≤–æ—Å—Ç]
   allowed_tools: [web_search, web_extract]
   weight: medium
   ---
   
–¢–µ—Å—Ç: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤ (—Å—Ç–∞—Ä—ã–π vs –Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç)
---
üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
Debug UI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—Ç–≤–µ—Ç –∞–≥–µ–Ω—Ç–∞ (–∫–æ–≥–¥–∞ DEBUG=true):
‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
[Debug: Loaded skills]
- core (always, 500 tokens)
- video-processing (semantic: 0.87, 800 tokens)
- web-search (trigger: –Ω–∞–π–¥–∏, 300 tokens)
Total skill tokens: 1600 / 2000 budget
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –î–æ–±–∞–≤–∏—Ç—å –≤ AgentSession::get_debug_info()
---
–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤–∏—Ç—å –≤ tracing:
info!(
    skills = ?selected_skills,
    total_tokens = skill_token_count,
    savings_percent = ((2000 - skill_token_count) * 100) / 2000,
    "Skills loaded for request"
);
–ú–µ—Å—Ç–æ: –í create_agent_system_prompt() –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Å–∫–∏–ª–ª–æ–≤
---
üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.rs)
–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
// Skill System
pub const SKILLS_DIR: &str = "skills";
pub const SKILL_TOKEN_BUDGET: usize = 1500;  // Max —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è —Å–∫–∏–ª–ª–æ–≤
pub const SKILL_EMBEDDING_THRESHOLD: f32 = 0.6;  // Min similarity score
pub const SKILL_MAX_SELECTED: usize = 3;  // Max —Å–∫–∏–ª–ª–æ–≤ –∑–∞ —Ä–∞–∑
pub const SKILL_CACHE_TTL_SECS: u64 = 3600;  // Hot reload –≤ dev
// Mistral Embeddings
pub const MISTRAL_EMBED_MODEL: &str = "mistral-embed";
pub const EMBEDDING_DIMENSION: usize = 256;
pub const EMBEDDING_CACHE_DIR: &str = ".embeddings_cache";
Environment Variables (–¥–ª—è override):
SKILL_TOKEN_BUDGET=1500
SKILL_SEMANTIC_THRESHOLD=0.6
MISTRAL_EMBED_MODEL=mistral-embed
---
‚ö†Ô∏è Edge Cases –∏ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ skills/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π AGENT.md
- Warning –≤ –ª–æ–≥–∞—Ö
2. –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ frontmatter
- –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–∫–∏–ª–ª —Å –æ—à–∏–±–∫–æ–π
- Error –≤ –ª–æ–≥–∞—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ñ–∞–π–ª–∞
- –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Å–∫–∏–ª–ª–∞–º–∏
3. Mistral API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ keyword matching (—Ç—Ä–∏–≥–≥–µ—Ä—ã)
- –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫–∏–ª–ª—ã —Å weight=High –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- Warning –≤ –ª–æ–≥–∞—Ö
4. –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ token budget
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∫–∏–ª–ª—ã –ø–æ priority: Always > High > Medium
- –ó–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ–∫–∞ –Ω–µ –∏—Å—á–µ—Ä–ø–∞–Ω –±—é–¥–∂–µ—Ç
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–∫–∏–ª–ª—ã
5. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π embedding dimension
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ API –≤—ã–∑–æ–≤–∞: vec.len() == 256
- –ï—Å–ª–∏ –Ω–µ—Ç - –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –≤–µ–∫—Ç–æ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å keyword fallback
---
üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞
1. –≠–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤: ‚â•50% –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. –¢–æ—á–Ω–æ—Å—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: ‚â•90% –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–∫–∏–ª–ª–æ–≤
3. –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: <100ms –Ω–∞ –≤—ã–±–æ—Ä —Å–∫–∏–ª–ª–æ–≤ (–ø–æ—Å–ª–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
4. Backward compatibility: –†–∞–±–æ—Ç–∞ –±–µ–∑ skills/ ‚Üí fallback –Ω–∞ AGENT.md
5. Developer UX: Hot reload —Å–∫–∏–ª–ª–æ–≤ –≤ dev —Ä–µ–∂–∏–º–µ
---
üìù –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
Another-Chat-with-LLM/
‚îú‚îÄ‚îÄ skills/                     # [–ù–û–í–û–ï] –ú–æ–¥—É–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ core.md
‚îÇ   ‚îú‚îÄ‚îÄ web-search.md
‚îÇ   ‚îú‚îÄ‚îÄ video-processing.md
‚îÇ   ‚îú‚îÄ‚îÄ file-management.md
‚îÇ   ‚îú‚îÄ‚îÄ file-hosting.md
‚îÇ   ‚îî‚îÄ‚îÄ task-planning.md
‚îú‚îÄ‚îÄ .embeddings_cache/          # [–ù–û–í–û–ï] –ö—ç—à –≤–µ–∫—Ç–æ—Ä–æ–≤ (gitignore)
‚îÇ   ‚îî‚îÄ‚îÄ skills/
‚îÇ       ‚îú‚îÄ‚îÄ web-search.bin
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ agent/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ skills/             # [–ù–û–í–û–ï] Skill System
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.rs
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loader.rs
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registry.rs
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embeddings.rs
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ matcher.rs
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cache.rs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ executor.rs         # [–ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–¢–¨]
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session.rs          # [–ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–¢–¨]
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ memory.rs           # [–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û]
‚îÇ   ‚îú‚îÄ‚îÄ llm/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ providers.rs        # [–ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–¢–¨] –¥–æ–±–∞–≤–∏—Ç—å embedding
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mod.rs              # [–ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–¢–¨]
‚îÇ   ‚îî‚îÄ‚îÄ config.rs               # [–ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–¢–¨]
‚îú‚îÄ‚îÄ AGENT.md                    # [DEPRECATED] –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ fallback
‚îú‚îÄ‚îÄ AGENT.md.backup             # [–ù–û–í–û–ï] –±—ç–∫–∞–ø –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ Cargo.toml                  # [–ü–†–û–í–ï–†–ò–¢–¨] –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
---