# UX Improvements: Agent Progress Display

> –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∞–≥–µ–Ω—Ç–∞ –≤ Telegram.

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

```
‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ (–∏—Ç–µ—Ä–∞—Ü–∏—è 1/200) [5.7k]
‚úÖ üîÑ –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ (1/20): –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞...
‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ (–∏—Ç–µ—Ä–∞—Ü–∏—è 2/200) [5.7k]
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: web_search
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: execute_command
...
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- `execute_command` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–∫–∞–∫—É—é –∫–æ–º–∞–Ω–¥—É** –≤—ã–ø–æ–ª–Ω—è–µ—Ç
- –ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ "—á—Ç–æ –∞–≥–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç" –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ
- –®—É–º–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–∏—Ç–µ—Ä–∞—Ü–∏–∏, retry)

---

## Gap Analysis

### 1. ToolCall —Å–æ–±—ã—Ç–∏–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∞–º—É –∫–æ–º–∞–Ω–¥—É

**–§–∞–π–ª:** `src/agent/tool_bridge.rs:84`

–°–µ–π—á–∞—Å `AgentEvent::ToolCall` –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–º—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏ JSON –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –î–ª—è `execute_command` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ª–∏—à—å –Ω–∞–∑–≤–∞–Ω–∏–µ, –Ω–æ –Ω–µ —Å–∞–º—É –∫–æ–º–∞–Ω–¥—É.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `‚è≥ pip install pandas` –≤–º–µ—Å—Ç–æ `‚è≥ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: execute_command`

### 2. –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –æ–±—Ä–µ–∑–∞—é—Ç—Å—è

**–§–∞–π–ª:** `src/agent/tool_bridge.rs:76`

–î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç—ã –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤. –î–ª—è UI —ç—Ç–æ –ø–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

### 3. –ù–µ—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —à–∞–≥–æ–≤

**–§–∞–π–ª:** `src/agent/progress.rs:format_telegram()`

–í—Å–µ —à–∞–≥–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ª–∏–Ω–µ–π–Ω–æ. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–ª–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å –æ–±—â—É—é –∫–∞—Ä—Ç–∏–Ω—É –ø—Ä–∏ 20+ —à–∞–≥–∞—Ö.

### 4. –ù–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

–°–æ–±—ã—Ç–∏—è `Thinking` ‚Üí `ToolCall` ‚Üí `ToolResult` –Ω–µ –æ–±—ä—è—Å–Ω—è—é—Ç **–∑–∞—á–µ–º** –∞–≥–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ.

---

## Proposed Changes

### Phase 1: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ AgentEvent

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

#### [MODIFY] src/agent/progress.rs

–†–∞—Å—à–∏—Ä–∏—Ç—å `AgentEvent::ToolCall`:
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `command_preview: Option<String>` ‚Äî —á–∏—Ç–∞–µ–º–æ–µ –ø—Ä–µ–≤—å—é –∫–æ–º–∞–Ω–¥—ã
- –î–ª—è `execute_command` –ø–∞—Ä—Å–∏—Ç—å JSON –∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å `command`

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:
- `AgentEvent::Planning { intent: String }` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º

#### [MODIFY] src/agent/tool_bridge.rs

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ `AgentEvent::ToolCall`:
- –ï—Å–ª–∏ `name == "execute_command"` ‚Äî —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON args –∏ –∏–∑–≤–ª–µ—á—å –ø–æ–ª–µ `command`
- –ü–µ—Ä–µ–¥–∞—Ç—å –∫–∞–∫ `command_preview`

---

### Phase 2: Hybrid Progress Format

**–¶–µ–ª—å:** –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å `format_telegram()` –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

#### [MODIFY] src/agent/progress.rs ‚Üí `format_telegram()`

–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–≤–æ–¥–∞:

```
ü§ñ Oxide Agent ‚îÇ –ò—Ç–µ—Ä–∞—Ü–∏—è 12/200 ‚îÇ 12k

üìã –ó–∞–¥–∞—á–∞ [2/5]: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã
  ‚úÖ web_search √ó4
  ‚úÖ execute_command √ó3

‚è≥ pip install pandas numpy
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. **Header**: –ò—Ç–µ—Ä–∞—Ü–∏—è + —Ç–æ–∫–µ–Ω—ã (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–æ)
2. **Todo Progress**: –¢–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞ –∏–∑ todos (–µ—Å–ª–∏ –µ—Å—Ç—å)
3. **Grouped Steps**: –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —à–∞–≥–∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ç–∏–ø—É –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
4. **Current Step**: –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —à–∞–≥ —Å –¥–µ—Ç–∞–ª—è–º–∏ (command_preview)

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

- `format_grouped_steps()` ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- `extract_tool_name()` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è —à–∞–≥–∞
- `current_step()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —à–∞–≥–∞

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/agent/
‚îú‚îÄ‚îÄ progress.rs          # AgentEvent enum, ProgressState, format_telegram()
‚îú‚îÄ‚îÄ tool_bridge.rs       # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ executor.rs          # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∞–≥–µ–Ω—Ç–∞
‚îî‚îÄ‚îÄ providers/
    ‚îî‚îÄ‚îÄ sandbox.rs       # execute_command implementation
```

---

## Verification

1. `cargo check` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
2. `cargo test progress` ‚Äî —Ç–µ—Å—Ç—ã –º–æ–¥—É–ª—è progress
3. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –∑–∞–¥–∞—á—É –±–æ—Ç—É, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
