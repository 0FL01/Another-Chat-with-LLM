# –ü—Ä–æ–µ–∫—Ç: Another Chat with LLM

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π Telegram-–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ API –±–æ–ª—å—à–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π (LLM) –¥–ª—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –º–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞. –ë–æ—Ç –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ, –≥–æ–ª–æ—Å–æ–≤—ã–µ, –≤–∏–¥–µ–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏, —É–ø—Ä–∞–≤–ª—è—Ç—å –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–∞ –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–µ—Å–æ—á–Ω–∏—Ü–µ.

–ë–æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Rust 1.92**, –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `teloxide`, AWS SDK –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Cloudflare R2, –∏ –Ω–∞—Ç–∏–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏ –ò–ò (Groq, Mistral AI, Google Gemini, OpenRouter, Zai).

## üèó –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ main.rs                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ lib.rs                     # –ö–æ—Ä–µ–Ω—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, —ç–∫—Å–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π
‚îú‚îÄ‚îÄ agent/                     # –õ–æ–≥–∏–∫–∞ —Ä–µ–∂–∏–º–∞ –ê–≥–µ–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îú‚îÄ‚îÄ session.rs             # –°–µ—Å—Å–∏—è –∞–≥–µ–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ executor.rs            # –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ memory.rs              # –ü–∞–º—è—Ç—å –∞–≥–µ–Ω—Ç–∞ (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ü–∏—è –≤ R2)
‚îÇ   ‚îú‚îÄ‚îÄ preprocessor.rs        # –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ progress.rs            # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ provider.rs            # –¢—Ä–µ–π—Ç ToolProvider
‚îÇ   ‚îú‚îÄ‚îÄ registry.rs            # –†–µ–µ—Å—Ç—Ä ToolRegistry
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                 # –•—É–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ completion.rs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registry.rs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.rs
‚îÇ   ‚îî‚îÄ‚îÄ providers/             # –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îÇ       ‚îú‚îÄ‚îÄ mod.rs
‚îÇ       ‚îú‚îÄ‚îÄ filehoster.rs      # GoFile-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (upload_file)
‚îÇ       ‚îú‚îÄ‚îÄ path.rs            # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—É—Ç–µ–π
‚îÇ       ‚îú‚îÄ‚îÄ sandbox.rs
‚îÇ       ‚îú‚îÄ‚îÄ tavily.rs
‚îÇ       ‚îú‚îÄ‚îÄ todos.rs
‚îÇ       ‚îî‚îÄ‚îÄ ytdlp.rs           # YT-DLP –ø—Ä–æ–≤–∞–π–¥–µ—Ä (YouTube, –≤–∏–¥–µ–æ-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
‚îú‚îÄ‚îÄ bot/                       # Telegram-–±–æ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îú‚îÄ‚îÄ handlers.rs            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ agent_handlers.rs      # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–µ–∂–∏–º–∞ –ê–≥–µ–Ω—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ state.rs               # –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ unauthorized_cache.rs  # –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ llm/                       # –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã LLM
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îú‚îÄ‚îÄ common.rs
‚îÇ   ‚îú‚îÄ‚îÄ providers.rs           # –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Groq, Gemini, etc)
‚îÇ   ‚îú‚îÄ‚îÄ openai_compat.rs       # OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îÇ   ‚îî‚îÄ‚îÄ http_utils.rs          # HTTP-—É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ sandbox/                   # –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–µ—Å–æ—á–Ω–∏—Ü—ã (Docker)
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs
‚îÇ   ‚îî‚îÄ‚îÄ manager.rs
‚îú‚îÄ‚îÄ storage.rs                 # –°–ª–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è (S3/R2)
‚îú‚îÄ‚îÄ config.rs                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ utils.rs                   # –£—Ç–∏–ª–∏—Ç—ã

tests/
‚îú‚îÄ‚îÄ cancellation_respected.rs   # –¢–µ—Å—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –æ—Ç–º–µ–Ω—ã
‚îú‚îÄ‚îÄ agent_xml_leak_prevention.rs # –¢–µ—Å—Ç—ã –∑–∞—â–∏—Ç—ã –æ—Ç —É—Ç–µ—á–µ–∫ XML
‚îî‚îÄ‚îÄ integration_validation.rs    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

sandbox/
‚îî‚îÄ‚îÄ Dockerfile.sandbox         # Docker-–æ–±—Ä–∞–∑ –ø–µ—Å–æ—á–Ω–∏—Ü—ã

.github/
‚îî‚îÄ‚îÄ workflows/
    ‚îî‚îÄ‚îÄ ci-cd.yml              # CI/CD –ø–∞–π–ø–ª–∞–π–Ω

Dockerfile                     # Docker-–æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker-compose.yml             # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## ü¶Ä Rust Coding Guidelines

### 1. Style & Idiomatic Rust
- **Compliance**: Follow the official [Rust API Guidelines](https://rust-lang.github.io/api-guidelines/).
- **Formatting**: ALWAYS run `cargo fmt` before final delivery.
- **Idioms**: Prefer functional combinators (`.map()`, `.and_then()`, `.collect()`) over imperative loops where it enhances readability.
- **Naming**: Strict `snake_case` for functions/variables, `PascalCase` for types/traits.

### 2. Architecture & Structure
- **Feature Isolation**: Maintain the feature-based directory structure. Modules in `agent/` must not directly depend on `bot/` logic.
- **File Management**: If a file exceeds **300 lines**, split it into a sub-module or extract logic into a separate file within the same directory.
- **Module Hierarchy**: Every directory must have a `mod.rs` (or `name.rs` + `name/` folder) clearly defining public vs private exports.

### 3. Safety & Error Handling (CRITICAL)
- **Zero Panic Policy**: ‚õî **NO `unwrap()`, `expect()`, or `panic!()`**. Use `Result<T, E>` and the `?` operator.
- **Lints**: No `#[allow(...)]` for Clippy. If Clippy fails, you MUST refactor.
- **Unsafe**: `unsafe_code = "forbid"` is enforced. Any bypass is a protocol violation.
- **Errors**: Use `thiserror` for library-level errors and `anyhow` for high-level application flow.

### 4. Complexity Control
- **Argument Limit**: If a function requires > 3 arguments, encapsulate them into a `struct Context` or `struct Config`.
- **Statics**: Use `lazy_regex` for Regex. Global state is permitted only via `Arc<T>` or `OnceLock`.

## üõ†Ô∏è –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–ù–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `workspace-info`, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Ç–æ–ø–æ–ª–æ–≥–∏—é –ø—Ä–æ–µ–∫—Ç–∞ (—á–ª–µ–Ω—ã, –ø–∞–∫–µ—Ç—ã) –±–µ–∑ —Ç—è–∂–µ–ª–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ `cargo metadata`.
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cargo-info [crate]` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π. –ò–∑–±–µ–≥–∞–π—Ç–µ —Ä—É—á–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è `Cargo.toml`.
- **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫**: –ï—Å–ª–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤—ã–¥–∞–µ—Ç –∫–æ–¥ –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, E0308), **–≤—Å–µ–≥–¥–∞** –∑–∞–ø—É—Å–∫–∞–π—Ç–µ `rustc-explain [code]`, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø—ã—Ç–∞—Ç—å—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –µ—ë.

### 2. –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
- **–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cargo-check`. –≠—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –∏ –¥–µ—à–µ–≤–ª–µ, —á–µ–º —Å–±–æ—Ä–∫–∞.
- **–ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cargo-build` —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É—é—Ç—Å—è –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã.
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
    - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cargo-test` –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤.
    - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cargo-hack` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Ñ–ª–∞–≥–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π (feature flags), –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –Ω–∏–º–∏.

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cargo-add` –∏ `cargo-remove`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cargo-update` –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è –≤–µ—Ä—Å–∏–π –≤ lock-—Ñ–∞–π–ª–µ.
- **–û—á–∏—Å—Ç–∫–∞**: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cargo-machete` –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

### 4. –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–õ–∏–Ω—Ç–∏–Ω–≥**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ `cargo-clippy` –ø–µ—Ä–µ–¥ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞.
- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `cargo-fmt` (—á–µ—Ä–µ–∑ `mcp:rust-mcp-server`) –ø–µ—Ä–µ–¥ –õ–Æ–ë–û–ô –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∫–æ–¥–∞ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è CI.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `cargo-deny-check` –¥–ª—è –∞—É–¥–∏—Ç–∞ –ª–∏—Ü–µ–Ω–∑–∏–π –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π.

## ‚ö° –ö–∞—Ä—Ç–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–ù–∞–º–µ—Ä–µ–Ω–∏–µ -> –ö–æ–º–∞–Ω–¥–∞)
| –ù–∞–º–µ—Ä–µ–Ω–∏–µ | –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç |
| :--- | :--- |
| "–ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –ª–∏ —ç—Ç–æ—Ç –∫–æ–¥?" | `cargo-check` |
| "–ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (features) –µ—Å—Ç—å —É X?" | `cargo-info X` |
| "–ß—Ç–æ –∑–∞ –æ—à–∏–±–∫–∞ E0xxx?" | `rustc-explain E0xxx` |
| "–û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏" | `cargo-machete` |
| "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å" | `cargo-hack` |
