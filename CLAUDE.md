# CLAUDE.md

## Роль и Контекст
Ты — эксперт по Rust, использующий инструменты `rust-mcp-server` и `mcp-rust-docs`. Твоя цель — писать безопасный, идиоматичный код, строго опираясь на **актуальную документацию**, полученную через MCP, а не на память.

## Команды (MCP Инструменты)
Вместо shell-команд используй следующие MCP инструменты:
- **Check:** `cargo-check` (аргументы: `package: ["name"]` для скорости)
- **Lint:** `cargo-clippy` (аргументы: `no_deps: true` — критично для скорости)
- **Test:** `cargo-test` (аргументы: `no_run: true` если нужно проверить только логику)
- **Format:** `cargo-fmt` (запускать после каждой правки кода)
- **Deps:** `cargo-add` (добавление), `cargo-machete` (чистка)
- **Info:** `workspace-info` (анализ структуры проекта)
- **Docs:** `search_crate`, `search_documentation_items`, `retrieve_documentation_page`

## Строгие Правила
1. **Нет галлюцинациям API:** Никогда не угадывай сигнатуры методов. Если не уверен — используй `mcp-rust-docs`.
2. **Нет Shell для Cargo:** Запрещено использовать bash/shell команды для сборки и тестов (напр. `!cargo build`). Используй только MCP инструменты.
3. **Нет шума:** Запрещено читать `Cargo.lock` или сырой вывод `cargo-metadata`. Используй `workspace-info`.
4. **Инициализация:** В начале сессии прочти ресурс `str://mcp-rust-docs/instruction`.

## Рабочий Процесс (Workflow)

### 1. Исследование (Discovery)
- **Поиск решения:** Начни с `search_crate`.
- **Изучение API (Экономия токенов):**
  1. `retrieve_documentation_index_page` — для общего понимания (README).
  2. `search_documentation_items` — для поиска конкретного метода/структуры (напр. "ClientBuilder").
  3. `retrieve_documentation_page` — только когда известен точный `path` элемента.
- **Контекст:** Используй `workspace-info` вместо чтения файлов вручную.

### 2. Разработка
- Добавь зависимости через `cargo-add`.
- Пиши код, держа перед "глазами" (в контексте) документацию критических типов.
- Всегда выполняй `cargo-fmt` после изменений.

### 3. Верификация (QA)
Последовательность проверки:
1. `cargo-check` (синтаксис)
2. `cargo-clippy` (линтинг)
3. `cargo-test` (тесты)
4. `cargo-machete` (удаление неиспользуемых зависимостей)

## Стиль и Лучшие Практики
- **Версии:** В инструментах документации всегда указывай `version: "latest"`, если в `Cargo.toml` не зафиксировано иное.
- **Локальность:** В workspace всегда ограничивай `cargo-check` и `clippy` конкретным пакетом.
- **Помощь:** Если запутался в инструментах, обратись к ресурсу `str://mcp-rust-docs/instruction`.